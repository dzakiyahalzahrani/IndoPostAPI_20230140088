<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Login | IndoPost API</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
* { box-sizing: border-box; font-family: system-ui, sans-serif; }

html, body {
  height: 100%;
  margin: 0;
  overflow: hidden;
  background: #f5f7fb;
}

/* NAVBAR (KONSISTEN) */
header{
  background:#1f2933;
  color:#fff;
  padding:14px 40px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
header b {
  font-size: 16px;
}
.nav a{
  margin-left:10px;
  padding:6px 14px;
  border-radius:6px;
  font-size:14px;
  text-decoration:none;
  color:#fff;
  border:1px solid #fff;
}
.nav .active{
  background:#facc15;
  color:#000;
  border:none;
  font-weight:600;
}

/* CARD */
.container {
  max-width: 420px;
  margin: 80px auto;
  background: #fff;
  padding: 30px;
  border-radius: 12px;
  box-shadow: 0 10px 25px rgba(0,0,0,.08);
}

h1 { margin-bottom: 20px; }

input, select, button {
  width: 100%;
  padding: 12px;
  margin-bottom: 12px;
  border-radius: 8px;
  border: 1px solid #ccc;
}

button {
  background: #2563eb;
  color: #fff;
  font-weight: 600;
  border: none;
  cursor: pointer;
}

.link {
  margin-top: 14px;
  font-size: 14px;
}

.error {
  color: red;
  font-size: 14px;
}

/* PASSWORD */
.password-wrapper {
  position: relative;
}
.password-wrapper input {
  padding-right: 44px;
}
.toggle-password {
  position: absolute;
  right: 12px;
  top: 50%;
  transform: translateY(-50%);
  cursor: pointer;
  display: flex;
  align-items: center;
}
.toggle-password svg {
  pointer-events: none;
}
</style>
</head>

<body>

<header>
  <b>IndoPost API</b>
  <div class="nav">
    <a href="/">Home</a>
    <a href="register.html" class="active">Register</a>
  </div>
</header>

<div class="container">
  <h1>Login</h1>

  <form id="loginForm">
    <input id="email" type="email" placeholder="Email" required>

    <div class="password-wrapper">
      <input id="password" type="password" placeholder="Password" required>
      <span class="toggle-password" onclick="togglePassword('password', this)">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
          <path d="M1 12s4-7 11-7 11 7 11 7-4 7-11 7S1 12 1 12Z"
                stroke="#555" stroke-width="2"/>
          <circle cx="12" cy="12" r="3"
                  stroke="#555" stroke-width="2"/>
        </svg>
      </span>
    </div>

    <select id="role">
      <option value="user">User</option>
      <option value="admin">Admin</option>
    </select>

    <button>Login</button>
  </form>

  <div class="error" id="error"></div>

  <div class="link">
    Belum punya akun? <a href="register.html">Register</a>
  </div>
</div>

<script>
loginForm.addEventListener('submit', async e => {
  e.preventDefault();

  const res = await fetch('/auth/login', {
    method: 'POST',
    headers: {'Content-Type':'application/json'},
    body: JSON.stringify({
      email: email.value,
      password: password.value
    })
  });

  const data = await res.json();
  if(!res.ok) return error.textContent = data.message;

  if(data.role !== role.value)
    return error.textContent = 'Role tidak sesuai dengan akun';

  localStorage.setItem('token', data.token);
  localStorage.setItem('role', data.role);

  location.href = data.role === 'admin'
    ? 'admin-dashboard.html'
    : 'user-dashboard.html';
});

function togglePassword(id, el){
  const input = document.getElementById(id);
  const svg = el.querySelector('svg');

  if(input.type === 'password'){
    input.type = 'text';
    svg.innerHTML = `
      <path d="M1 12s4-7 11-7 11 7 11 7-4 7-11 7S1 12 1 12Z"
            stroke="#555" stroke-width="2"/>
      <line x1="3" y1="3" x2="21" y2="21"
            stroke="#555" stroke-width="2"/>
    `;
  } else {
    input.type = 'password';
    svg.innerHTML = `
      <path d="M1 12s4-7 11-7 11 7 11 7-4 7-11 7S1 12 1 12Z"
            stroke="#555" stroke-width="2"/>
      <circle cx="12" cy="12" r="3"
              stroke="#555" stroke-width="2"/>
    `;
  }
}
</script>

</body>
</html>
